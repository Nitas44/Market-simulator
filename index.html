<!DOCTYPE html>
<html lang="es">
<head>
<meta charset="UTF-8">
<title>Market Simulator</title>
<link rel="icon" href="favicon.ico" type="image/x-icon">
<script src="https://cdn.jsdelivr.net/npm/chart.js@4.4.1/dist/chart.umd.min.js"></script>
<style>
body{margin:0;background:#0b0b0b;color:white;font-family:Arial,sans-serif;text-align:center}
header{padding:8px;font-size:20px;font-weight:bold}
.price{font-size:34px}
.percent{font-size:16px;margin-bottom:4px}
.small{font-size:14px;opacity:.85}
.legend{font-size:13px;margin-top:4px}
.buttons button{margin:4px;padding:6px 14px;font-size:15px}
.chart-box{height:70vh;padding:10px}
</style>
</head>
<body>
<header>ðŸ“ˆ Market Simulator</header>
<div class="price" id="price">$10.00</div>
<div class="percent" id="percent">â–² 0.00%</div>
<div class="small">Balance: $<span id="balance">100.00</span> | Shares: <span id="shares">0</span></div>
<div class="legend">ðŸŸ¢ Precio del mercado | ðŸ”µ Buy | ðŸŸ¡ Sell</div>
<div class="buttons">
<button onclick="buy()">Buy</button>
<button onclick="sell()">Sell</button>
<button onclick="pause()">Pause</button>
<button onclick="resetGame()">New Game</button>
</div>
<div class="chart-box"><canvas id="chart"></canvas></div>

<script>
let price, balance, shares, paused;
const points = 40;
let priceData, buyPoints, sellPoints, chart;

function init(){
  price = 10;
  balance = 100;
  shares = 0;
  paused = false;

  priceData = Array(points).fill(price);
  buyPoints = Array(points).fill(null);
  sellPoints = Array(points).fill(null);

  if(chart) chart.destroy();

  chart = new Chart(document.getElementById('chart'),{
    type:'line',
    data:{
      labels:Array(points).fill(''),
      datasets:[
        {data:priceData,borderColor:'#00ff6a',borderWidth:3,pointRadius:0,tension:.3},
        {data:buyPoints,type:'scatter',pointBackgroundColor:'#004cff',pointRadius:6},
        {data:sellPoints,type:'scatter',pointBackgroundColor:'#ffcc00',pointRadius:6}
      ]
    },
    options:{
      animation:false,
      responsive:true,
      maintainAspectRatio:false,
      plugins:{legend:{display:false}},
      scales:{
        x:{display:false},
        y:{ticks:{color:'white',callback:v=>'$'+v.toFixed(2)}}
      }
    }
  });
  updateUI();
}

init();
startInterval();

function startInterval(){
  clearInterval(window.priceInterval);
  window.priceInterval = setInterval(()=>{
    if(paused) return;

    // ðŸ”¥ SIEMPRE sube 0.50 dÃ³lares
    price += 0.50;

    priceData.push(price);
    priceData.shift();

    buyPoints.push(null);
    buyPoints.shift();

    sellPoints.push(null);
    sellPoints.shift();

    updateUI();
    chart.update();
  }, 2300); // cada 2.3 segundos
}

function buy(){
  if(balance >= price){
    balance -= price;
    shares++;
    buyPoints[buyPoints.length - 1] = price;
    updateUI();
  }
}

function sell(){
  if(shares > 0){
    balance += price;
    shares--;
    sellPoints[sellPoints.length - 1] = price;
    updateUI();
  }
}

function pause(){
  paused = !paused;
}

function resetGame(){
  init();
}

function updateUI(){
  document.getElementById('price').textContent = '$' + price.toFixed(2);

  let equity;
  let pct;

  if(shares === 0){
    equity = balance;
    pct = 0;
  } else {
    equity = balance + shares * price;
    pct = ((equity - 100) / 100) * 100;
  }

  const pctEl = document.getElementById('percent');
  pctEl.textContent = (pct >= 0 ? 'â–² ' : 'â–¼ ') + pct.toFixed(2) + '%';
  pctEl.style.color = pct >= 0 ? '#00ff6a' : '#ff4d4d';

  document.getElementById('balance').textContent = balance.toFixed(2);
  document.getElementById('shares').textContent = shares;
}
</script>
</body>
</html>
