<!DOCTYPE html>
<html>
<head>
<title>Market Simulator</title>
<script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
<style>
body{
    background:black;
    color:white;
    text-align:center;
    font-family:Arial;
    margin:0;
}
button{
    margin:5px;
    padding:6px 12px;
    cursor:pointer;
}
.stockBox{
    width:700px;
    margin:15px auto;
}
canvas{
    background:#111;
}
#eventMessage{
    font-size:20px;
    font-weight:bold;
    margin:10px;
    height:25px;
}
</style>
</head>
<body>

<h1>ðŸ“ˆ Market Simulator</h1>

<h2>Balance: $<span id="balance">50.00</span></h2>
<div id="eventMessage"></div>

<button onclick="changeStock('tech')">Tech</button>
<button onclick="changeStock('energy')">Energy</button>
<button onclick="changeStock('crypto')">Crypto</button>
<button onclick="showAll()">Show All</button>
<button onclick="togglePause()">Pause</button>
<button onclick="newGame()">New Game</button>

<div id="content"></div>

<script>

let balance;
let stocks;
let currentStock = "tech";
let maxPoints = 30;
let interval;
let paused = false;

function startGame(){
    balance = 50;   // ðŸ‘ˆ CAMBIADO A 50
    stocks = {
        tech: { price:10, shares:0, history:[10], buys:[], sells:[], color:"white" },
        energy: { price:10, shares:0, history:[10], buys:[], sells:[], color:"#66ccff" },
        crypto: { price:10, shares:0, history:[10], buys:[], sells:[], color:"purple" }
    };
    document.getElementById("balance").innerText = balance.toFixed(2);
    document.getElementById("eventMessage").innerText = "";
    changeStock("tech");
    interval = setInterval(updatePrices,2300);
}

function updatePrices(){
    if(paused) return;

    for(let key in stocks){

        let change = Math.random() > 0.5 ? 0.50 : -0.50;

        stocks[key].price += change;
        if(stocks[key].price < 1) stocks[key].price = 1;

        stocks[key].history.push(stocks[key].price);

        if(stocks[key].history.length > maxPoints){
            stocks[key].history.shift();
            stocks[key].buys = stocks[key].buys.map(i=>i-1).filter(i=>i>=0);
            stocks[key].sells = stocks[key].sells.map(i=>i-1).filter(i=>i>=0);
        }
    }

    render();
}

function render(){

    document.getElementById("balance").innerText = balance.toFixed(2);

    if(currentStock === "all"){
        let html = "";
        for(let key in stocks){
            html += `
            <div class="stockBox">
                <h3>${key.toUpperCase()} - $${stocks[key].price.toFixed(2)}</h3>
                <p>Shares: ${stocks[key].shares}</p>
                <p>Value: $${(stocks[key].shares * stocks[key].price).toFixed(2)}</p>
                <button onclick="buy('${key}')">Buy</button>
                <button onclick="sell('${key}')">Sell</button>
                <canvas id="chart-${key}" width="700" height="200"></canvas>
            </div>
            `;
        }
        document.getElementById("content").innerHTML = html;

        for(let key in stocks){
            createChart(key);
        }

    } else {
        let s = stocks[currentStock];
        document.getElementById("content").innerHTML = `
        <div class="stockBox">
            <h3>${currentStock.toUpperCase()} - $${s.price.toFixed(2)}</h3>
            <p>Shares: ${s.shares}</p>
            <p>Value: $${(s.shares * s.price).toFixed(2)}</p>
            <button onclick="buy('${currentStock}')">Buy</button>
            <button onclick="sell('${currentStock}')">Sell</button>
            <canvas id="chart-${currentStock}" width="700" height="300"></canvas>
        </div>
        `;
        createChart(currentStock);
    }
}

function createChart(key){
    let ctx = document.getElementById(`chart-${key}`).getContext("2d");

    new Chart(ctx,{
        type:"line",
        data:{
            labels:stocks[key].history.map(()=> ""),
            datasets:[
                {
                    data:stocks[key].history,
                    borderColor:stocks[key].color,
                    borderWidth:2,
                    pointRadius:0,
                    tension:0.4
                },
                {
                    data:stocks[key].history.map((v,i)=>
                        stocks[key].buys.includes(i)? v : null),
                    pointBackgroundColor:"darkblue",
                    pointRadius:6,
                    showLine:false
                },
                {
                    data:stocks[key].history.map((v,i)=>
                        stocks[key].sells.includes(i)? v : null),
                    pointBackgroundColor:"yellow",
                    pointRadius:6,
                    showLine:false
                }
            ]
        },
        options:{
            animation:false,
            plugins:{legend:{display:false}},
            scales:{
                x:{display:false},
                y:{ticks:{color:"white"}}
            }
        }
    });
}

function changeStock(name){
    currentStock = name;
    render();
}

function showAll(){
    currentStock = "all";
    render();
}

function buy(key){
    if(balance >= stocks[key].price){
        stocks[key].shares++;
        balance -= stocks[key].price;
        stocks[key].buys.push(stocks[key].history.length-1);
        render();
    }
}

function sell(key){
    if(stocks[key].shares > 0){
        stocks[key].shares--;
        balance += stocks[key].price;
        stocks[key].sells.push(stocks[key].history.length-1);
        render();
    }
}

function togglePause(){
    paused = !paused;
}

function newGame(){
    clearInterval(interval);
    startGame();
}

startGame();

</script>

</body>
</html>
